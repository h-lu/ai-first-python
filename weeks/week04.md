# 第4周：函数与模块化设计

> **课时**：2课时 | **阶段**：人机协同编程基础

## 🎯 学习目标

- 理解函数的作用和模块化思想
- 学会用自然语言描述功能，让 AI 生成函数
- 掌握函数的输入输出设计原则

---

## 📚 课程内容

### 1. 为什么需要函数？（20分钟）

**从复制粘贴到抽象**

❌ 不好的代码：
```python
# 计算学生1的平均分
total1 = 80 + 90 + 75
avg1 = total1 / 3
print(f"学生1平均分: {avg1}")

# 计算学生2的平均分
total2 = 85 + 88 + 92
avg2 = total2 / 3
print(f"学生2平均分: {avg2}")

# 计算学生3的平均分...（重复10次）
```

✅ 好的代码：
```python
def calculate_average(scores):
    return sum(scores) / len(scores)

print(f"学生1平均分: {calculate_average([80, 90, 75])}")
print(f"学生2平均分: {calculate_average([85, 88, 92])}")
```

**函数的好处**：
- 避免重复代码
- 易于修改和维护
- 代码更易读

### 2. 用自然语言让 AI 生成函数（40分钟）

**Prompt 模板**：
```
写一个 Python 函数 [函数名]：
- 功能：[做什么]
- 输入参数：[参数1]（类型，说明）, [参数2]...
- 返回值：[返回什么]
- 边界处理：[特殊情况怎么办]
- 示例：[输入] → [输出]
```

**课堂练习 1**：成绩等级转换
```
写一个函数 score_to_grade(score)：
- 输入：分数（0-100的整数）
- 输出：等级字符串（优秀/良好/中等/及格/不及格）
- 规则：90+优秀，80-89良好，70-79中等，60-69及格，60以下不及格
- 边界：如果分数不在0-100范围，返回"无效分数"
```

**课堂练习 2**：手机号格式化
```
写一个函数 format_phone(phone)：
- 输入：手机号字符串（可能含空格、横线）
- 输出：格式化后的手机号 "xxx-xxxx-xxxx"
- 边界：如果清理后不是11位数字，返回 None
```

### 3. 函数的输入输出设计原则（20分钟）

| 原则 | 说明 | 示例 |
|-----|------|------|
| **单一职责** | 一个函数只做一件事 | ✅ `calculate_avg()` ❌ `calculate_avg_and_print()` |
| **明确输入** | 参数要有意义 | ✅ `(name, age)` ❌ `(a, b)` |
| **确定输出** | 返回值类型一致 | ✅ 总是返回数字 ❌ 有时返回数字有时返回字符串 |
| **处理边界** | 考虑异常情况 | 空列表、无效输入 |

### 4. Cursor Tab Complete 演示（20分钟）

**Cursor 快捷功能**：
- **Tab 补全**：AI 预测你的下一步
- **Ctrl+K**：在当前位置生成代码
- **Ctrl+L**：打开聊天窗口

**实操演示**：
1. 输入函数签名，让 AI 补全函数体
2. 写注释，让 AI 理解意图并生成代码
3. 选中代码片段，让 AI 重构

---

## 📝 课后作业

### 开始作业 2：成绩统计分析器

**本周任务**：
1. 用 AI 生成以下函数：
   - `load_csv(filepath)` - 加载成绩文件
   - `calculate_average(scores)` - 计算平均分
   - `get_distribution(scores)` - 生成分数分布
   - `get_ranking(students)` - 生成排名（处理并列）

2. 记录每个函数的 Prompt 和 AI 生成的代码

**REPORT.md 要求**：
- 展示至少 2 个函数的 Prompt 设计过程
- AI 第一次生成的代码有什么需要修改的？

---

## 🔧 代码模板

```python
def load_csv(filepath):
    """加载成绩CSV文件
    
    Args:
        filepath: CSV文件路径
        
    Returns:
        学生成绩列表，每个元素是字典 {'id': '001', 'name': '张三', 'score': 85}
        如果文件不存在或格式错误，返回空列表
    """
    pass  # TODO: 用 AI 生成实现

def calculate_average(scores):
    """计算平均分
    
    Args:
        scores: 分数列表
        
    Returns:
        平均分（保留2位小数），如果列表为空返回 None
    """
    pass  # TODO: 用 AI 生成实现
```

---

## 💡 教学提示

- 强调"先想清楚函数签名，再让 AI 写实现"
- 让学生体验 Tab Complete 的高效率
- 本周开始培养"写注释 → 生成代码"的习惯
