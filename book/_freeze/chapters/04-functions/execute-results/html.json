{
  "hash": "03d40c0d27d7d39f6071b2fba8c0ea36",
  "result": {
    "engine": "jupyter",
    "markdown": "# 函数与模块化设计 {#sec-functions}\n\n::: {.callout-note}\n## 本章概要\n- **课时**：2课时（第4周）\n- **目标**：理解函数的作用，用自然语言描述功能让 AI 生成函数\n:::\n\n## 学习目标\n\n完成本章后，你将能够：\n\n1. 理解函数的作用和模块化思想\n2. 用自然语言描述功能需求，让 AI 生成函数\n3. 设计合理的函数输入输出\n\n---\n\n## 为什么需要函数？\n\n### 从\"复制粘贴\"到\"一次定义，多次使用\"\n\n假设你需要计算 10 个学生的平均分：\n\n**❌ 不好的代码**（复制粘贴）：\n\n::: {#390e7540 .cell execution_count=1}\n``` {.python .cell-code}\n# 计算学生1的平均分\ntotal1 = 80 + 90 + 75\navg1 = total1 / 3\nprint(f\"学生1平均分: {avg1}\")\n\n# 计算学生2的平均分\ntotal2 = 85 + 88 + 92\navg2 = total2 / 3\nprint(f\"学生2平均分: {avg2}\")\n\n# 计算学生3的平均分...（重复10次）\n```\n:::\n\n\n**✅ 好的代码**（使用函数）：\n\n::: {#c88e1dac .cell execution_count=2}\n``` {.python .cell-code}\ndef calculate_average(scores):\n    \"\"\"计算平均分\"\"\"\n    return sum(scores) / len(scores)\n\n# 简洁！一行搞定\nprint(f\"学生1平均分: {calculate_average([80, 90, 75])}\")\nprint(f\"学生2平均分: {calculate_average([85, 88, 92])}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n学生1平均分: 81.66666666666667\n学生2平均分: 88.33333333333333\n```\n:::\n:::\n\n\n### 函数的好处\n\n```{mermaid}\nmindmap\n  root((函数的好处))\n    避免重复\n      一次编写\n      多次调用\n    易于修改\n      改一处\n      处处生效\n    代码清晰\n      命名表意\n      逻辑分离\n    便于测试\n      独立单元\n      可验证\n```\n\n| 问题 | 没有函数 | 使用函数 |\n|-----|---------|---------|\n| 修改计算逻辑 | 改 N 处 | 改 1 处 |\n| 代码行数 | 30+ 行 | 5 行 |\n| 出错概率 | 高（复制容易出错） | 低 |\n| 可读性 | 差（重复代码） | 好（语义清晰） |\n\n---\n\n## 函数的基本结构\n\n::: {#81c4ee00 .cell execution_count=3}\n``` {.python .cell-code}\ndef greet(name, greeting=\"你好\"):\n    \"\"\"\n    问候函数\n    \n    Args:\n        name: 被问候的人名\n        greeting: 问候语，默认\"你好\"\n    \n    Returns:\n        问候字符串\n    \"\"\"\n    return f\"{greeting}，{name}！\"\n\n# 调用函数\nprint(greet(\"张三\"))          # 使用默认值\nprint(greet(\"李四\", \"早上好\"))  # 自定义问候语\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n你好，张三！\n早上好，李四！\n```\n:::\n:::\n\n\n### 函数结构解析\n\n```{mermaid}\nflowchart TD\n    A[\"def 函数名(参数):\"] --> B[\"文档字符串 (docstring)\"]\n    B --> C[\"函数体（处理逻辑）\"]\n    C --> D[\"return 返回值\"]\n    \n    style A fill:#e1f5fe\n    style B fill:#fff9c4\n    style C fill:#f3e5f5\n    style D fill:#e8f5e9\n```\n\n| 组成部分 | 说明 | 示例 |\n|---------|------|------|\n| `def` | 定义函数的关键字 | `def calculate_average` |\n| 函数名 | 有意义的名称（动词开头） | `calculate_average`, `get_user`, `format_phone` |\n| 参数 | 输入数据 | `(scores)`, `(name, age)` |\n| 文档字符串 | 说明函数用途 | `\"\"\"计算平均分\"\"\"` |\n| 函数体 | 处理逻辑 | 计算、判断、操作 |\n| 返回值 | 输出结果 | `return result` |\n\n---\n\n## 用自然语言让 AI 生成函数\n\n### Prompt 模板\n\n```\n写一个 Python 函数 [函数名]：\n- 功能：[做什么]\n- 输入参数：[参数1]（类型，说明）, [参数2]...\n- 返回值：[返回什么]\n- 边界处理：[特殊情况怎么办]\n- 示例：[输入] → [输出]\n```\n\n### 课堂练习 1：成绩等级转换\n\n**Prompt**：\n```\n写一个函数 score_to_grade(score)：\n- 输入：分数（0-100的整数）\n- 输出：等级字符串（优秀/良好/中等/及格/不及格）\n- 规则：90+优秀，80-89良好，70-79中等，60-69及格，60以下不及格\n- 边界：如果分数不在0-100范围，返回\"无效分数\"\n```\n\n**AI 生成的代码**：\n\n::: {#db538033 .cell execution_count=4}\n``` {.python .cell-code}\ndef score_to_grade(score):\n    \"\"\"将分数转换为等级\"\"\"\n    if not isinstance(score, (int, float)):\n        return \"无效分数\"\n    if score < 0 or score > 100:\n        return \"无效分数\"\n    \n    if score >= 90:\n        return \"优秀\"\n    elif score >= 80:\n        return \"良好\"\n    elif score >= 70:\n        return \"中等\"\n    elif score >= 60:\n        return \"及格\"\n    else:\n        return \"不及格\"\n\n# 测试\nprint(score_to_grade(95))   # 优秀\nprint(score_to_grade(85))   # 良好\nprint(score_to_grade(55))   # 不及格\nprint(score_to_grade(-10))  # 无效分数\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n优秀\n良好\n不及格\n无效分数\n```\n:::\n:::\n\n\n### 课堂练习 2：手机号格式化\n\n**Prompt**：\n```\n写一个函数 format_phone(phone)：\n- 输入：手机号字符串（可能含空格、横线）\n- 输出：格式化后的手机号 \"xxx-xxxx-xxxx\"\n- 边界：如果清理后不是11位数字，返回 None\n```\n\n**AI 生成的代码**：\n\n::: {#500a7a30 .cell execution_count=5}\n``` {.python .cell-code}\ndef format_phone(phone):\n    \"\"\"格式化手机号为 xxx-xxxx-xxxx 格式\"\"\"\n    if not phone:\n        return None\n    \n    # 只保留数字\n    cleaned = ''.join(c for c in phone if c.isdigit())\n    \n    # 检查长度\n    if len(cleaned) != 11:\n        return None\n    \n    return f\"{cleaned[:3]}-{cleaned[3:7]}-{cleaned[7:]}\"\n\n# 测试\nprint(format_phone(\"138 0013 8000\"))     # 138-0013-8000\nprint(format_phone(\"138-0013-8000\"))     # 138-0013-8000\nprint(format_phone(\"12345\"))             # None\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n138-0013-8000\n138-0013-8000\nNone\n```\n:::\n:::\n\n\n---\n\n## 函数设计原则\n\n### 单一职责原则\n\n一个函数只做一件事！\n\n```{mermaid}\nflowchart LR\n    subgraph \"❌ 不好的设计\"\n        A[\"calculate_and_print_and_save()\"]\n    end\n    \n    subgraph \"✅ 好的设计\"\n        B[\"calculate()\"] --> C[\"format()\"]\n        C --> D[\"save()\"]\n    end\n```\n\n**❌ 不好**：\n```python\ndef process_scores(scores):\n    avg = sum(scores) / len(scores)  # 计算\n    print(f\"平均分: {avg}\")           # 打印\n    with open(\"result.txt\", \"w\") as f:  # 保存\n        f.write(str(avg))\n    return avg\n```\n\n**✅ 好**：\n```python\ndef calculate_average(scores):\n    return sum(scores) / len(scores)\n\ndef format_result(avg):\n    return f\"平均分: {avg:.2f}\"\n\ndef save_result(result, filepath):\n    with open(filepath, \"w\") as f:\n        f.write(result)\n```\n\n### 设计原则速查\n\n| 原则 | 说明 | 示例 |\n|-----|------|------|\n| **单一职责** | 一个函数只做一件事 | ✅ `calculate_avg()` ❌ `calculate_avg_and_print()` |\n| **明确命名** | 用动词开头，表达意图 | ✅ `get_user()` ❌ `user()` |\n| **参数有意义** | 参数名要有含义 | ✅ `(name, age)` ❌ `(a, b)` |\n| **返回值明确** | 类型一致，避免意外 | ✅ 总是返回数字 ❌ 有时返回数字有时返回字符串 |\n| **处理边界** | 考虑异常情况 | 空列表、无效输入 |\n\n---\n\n## 实战：设计成绩分析模块\n\n让我们一起设计一个成绩分析模块，包含多个函数。\n\n### 第一步：需求分解\n\n```{mermaid}\nflowchart TD\n    A[\"成绩分析需求\"] --> B[\"加载数据\"]\n    A --> C[\"基础统计\"]\n    A --> D[\"等级分析\"]\n    A --> E[\"生成报告\"]\n    \n    B --> B1[\"load_scores()\"]\n    C --> C1[\"calculate_average()\"]\n    C --> C2[\"get_max_min()\"]\n    D --> D1[\"get_grade_distribution()\"]\n    E --> E1[\"generate_report()\"]\n```\n\n### 第二步：逐个实现\n\n::: {#91252708 .cell execution_count=6}\n``` {.python .cell-code}\ndef calculate_average(scores):\n    \"\"\"计算平均分\"\"\"\n    if not scores:\n        return None\n    return sum(scores) / len(scores)\n\ndef get_max_min(scores):\n    \"\"\"获取最高分和最低分\"\"\"\n    if not scores:\n        return None, None\n    return max(scores), min(scores)\n\ndef get_grade_distribution(scores):\n    \"\"\"统计各等级人数\"\"\"\n    distribution = {\"优秀\": 0, \"良好\": 0, \"中等\": 0, \"及格\": 0, \"不及格\": 0}\n    for score in scores:\n        grade = score_to_grade(score)\n        if grade in distribution:\n            distribution[grade] += 1\n    return distribution\n\ndef generate_report(scores):\n    \"\"\"生成分析报告\"\"\"\n    avg = calculate_average(scores)\n    max_score, min_score = get_max_min(scores)\n    distribution = get_grade_distribution(scores)\n    \n    return {\n        \"人数\": len(scores),\n        \"平均分\": round(avg, 2) if avg else None,\n        \"最高分\": max_score,\n        \"最低分\": min_score,\n        \"等级分布\": distribution\n    }\n\n# 测试\nscores = [92, 85, 78, 65, 55, 88, 72, 60, 95, 42]\nreport = generate_report(scores)\nprint(report)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{'人数': 10, '平均分': 73.2, '最高分': 95, '最低分': 42, '等级分布': {'优秀': 2, '良好': 2, '中等': 2, '及格': 2, '不及格': 2}}\n```\n:::\n:::\n\n\n---\n\n## Cursor 实用技巧\n\n### Tab 补全\n\n在 Cursor 中，输入函数签名后，AI 会自动预测函数体：\n\n```python\ndef calculate_average(scores):\n    # 输入到这里，按 Tab 让 AI 补全\n```\n\n### Ctrl+K 生成\n\n1. 把光标放在想要生成代码的位置\n2. 按 `Ctrl+K`（Mac: `Cmd+K`）\n3. 输入描述，如：\"写一个函数计算列表中正数的个数\"\n4. AI 直接在光标位置生成代码\n\n### 选中后让 AI 重构\n\n1. 选中一段代码\n2. 按 `Ctrl+L`（Mac: `Cmd+L`）\n3. 说：\"把这段代码重构成函数\"\n\n---\n\n## 课后作业\n\n### 开始作业 2：成绩统计分析器\n\n**本周任务**：用 AI 生成以下函数：\n\n1. `load_csv(filepath)` - 加载成绩文件\n2. `calculate_average(scores)` - 计算平均分\n3. `get_distribution(scores)` - 生成分数分布\n4. `get_ranking(students)` - 生成排名（处理并列）\n\n**REPORT.md 要求**：\n- 展示至少 2 个函数的 Prompt 设计过程\n- 分析 AI 第一次生成的代码有什么需要修改的\n\n---\n\n## 本章小结\n\n- **函数**是代码复用的基本单元：一次编写，多次调用\n- **函数设计原则**：单一职责、明确命名、处理边界\n- **Prompt 技巧**：描述功能、输入输出、边界情况、示例\n- **Cursor 技巧**：Tab 补全、Ctrl+K 生成、选中重构\n- 先想清楚**函数签名**（名称、参数、返回值），再让 AI 写实现\n\n下一章，我们将学习**数据结构**——如何选择合适的方式组织数据。\n\n",
    "supporting": [
      "04-functions_files"
    ],
    "filters": [],
    "includes": {}
  }
}