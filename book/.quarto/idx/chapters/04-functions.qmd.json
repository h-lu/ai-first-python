{"title":"函数与模块化设计","markdown":{"headingText":"函数与模块化设计","headingAttr":{"id":"sec-functions","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n::: {.callout-note}\n## 本章概要\n- **课时**：2课时（第4周）\n- **目标**：理解函数的作用，用自然语言描述功能让 AI 生成函数\n:::\n\n## 学习目标\n\n完成本章后，你将能够：\n\n1. 理解函数的作用和模块化思想\n2. 用自然语言描述功能需求，让 AI 生成函数\n3. 设计合理的函数输入输出\n\n---\n\n## 为什么需要函数？\n\n### 从\"复制粘贴\"到\"一次定义，多次使用\"\n\n假设你需要计算 10 个学生的平均分：\n\n**❌ 不好的代码**（复制粘贴）：\n\n```{python}\n#| eval: false\n# 计算学生1的平均分\ntotal1 = 80 + 90 + 75\navg1 = total1 / 3\nprint(f\"学生1平均分: {avg1}\")\n\n# 计算学生2的平均分\ntotal2 = 85 + 88 + 92\navg2 = total2 / 3\nprint(f\"学生2平均分: {avg2}\")\n\n# 计算学生3的平均分...（重复10次）\n```\n\n**✅ 好的代码**（使用函数）：\n\n```{python}\n#| eval: true\ndef calculate_average(scores):\n    \"\"\"计算平均分\"\"\"\n    return sum(scores) / len(scores)\n\n# 简洁！一行搞定\nprint(f\"学生1平均分: {calculate_average([80, 90, 75])}\")\nprint(f\"学生2平均分: {calculate_average([85, 88, 92])}\")\n```\n\n### 函数的好处\n\n```{mermaid}\nmindmap\n  root((函数的好处))\n    避免重复\n      一次编写\n      多次调用\n    易于修改\n      改一处\n      处处生效\n    代码清晰\n      命名表意\n      逻辑分离\n    便于测试\n      独立单元\n      可验证\n```\n\n| 问题 | 没有函数 | 使用函数 |\n|-----|---------|---------|\n| 修改计算逻辑 | 改 N 处 | 改 1 处 |\n| 代码行数 | 30+ 行 | 5 行 |\n| 出错概率 | 高（复制容易出错） | 低 |\n| 可读性 | 差（重复代码） | 好（语义清晰） |\n\n---\n\n## 函数的基本结构\n\n```{python}\n#| eval: true\ndef greet(name, greeting=\"你好\"):\n    \"\"\"\n    问候函数\n    \n    Args:\n        name: 被问候的人名\n        greeting: 问候语，默认\"你好\"\n    \n    Returns:\n        问候字符串\n    \"\"\"\n    return f\"{greeting}，{name}！\"\n\n# 调用函数\nprint(greet(\"张三\"))          # 使用默认值\nprint(greet(\"李四\", \"早上好\"))  # 自定义问候语\n```\n\n### 函数结构解析\n\n```{mermaid}\nflowchart TD\n    A[\"def 函数名(参数):\"] --> B[\"文档字符串 (docstring)\"]\n    B --> C[\"函数体（处理逻辑）\"]\n    C --> D[\"return 返回值\"]\n    \n    style A fill:#e1f5fe\n    style B fill:#fff9c4\n    style C fill:#f3e5f5\n    style D fill:#e8f5e9\n```\n\n| 组成部分 | 说明 | 示例 |\n|---------|------|------|\n| `def` | 定义函数的关键字 | `def calculate_average` |\n| 函数名 | 有意义的名称（动词开头） | `calculate_average`, `get_user`, `format_phone` |\n| 参数 | 输入数据 | `(scores)`, `(name, age)` |\n| 文档字符串 | 说明函数用途 | `\"\"\"计算平均分\"\"\"` |\n| 函数体 | 处理逻辑 | 计算、判断、操作 |\n| 返回值 | 输出结果 | `return result` |\n\n---\n\n## 用自然语言让 AI 生成函数\n\n### Prompt 模板\n\n```\n写一个 Python 函数 [函数名]：\n- 功能：[做什么]\n- 输入参数：[参数1]（类型，说明）, [参数2]...\n- 返回值：[返回什么]\n- 边界处理：[特殊情况怎么办]\n- 示例：[输入] → [输出]\n```\n\n### 课堂练习 1：成绩等级转换\n\n**Prompt**：\n```\n写一个函数 score_to_grade(score)：\n- 输入：分数（0-100的整数）\n- 输出：等级字符串（优秀/良好/中等/及格/不及格）\n- 规则：90+优秀，80-89良好，70-79中等，60-69及格，60以下不及格\n- 边界：如果分数不在0-100范围，返回\"无效分数\"\n```\n\n**AI 生成的代码**：\n\n```{python}\n#| eval: true\ndef score_to_grade(score):\n    \"\"\"将分数转换为等级\"\"\"\n    if not isinstance(score, (int, float)):\n        return \"无效分数\"\n    if score < 0 or score > 100:\n        return \"无效分数\"\n    \n    if score >= 90:\n        return \"优秀\"\n    elif score >= 80:\n        return \"良好\"\n    elif score >= 70:\n        return \"中等\"\n    elif score >= 60:\n        return \"及格\"\n    else:\n        return \"不及格\"\n\n# 测试\nprint(score_to_grade(95))   # 优秀\nprint(score_to_grade(85))   # 良好\nprint(score_to_grade(55))   # 不及格\nprint(score_to_grade(-10))  # 无效分数\n```\n\n### 课堂练习 2：手机号格式化\n\n**Prompt**：\n```\n写一个函数 format_phone(phone)：\n- 输入：手机号字符串（可能含空格、横线）\n- 输出：格式化后的手机号 \"xxx-xxxx-xxxx\"\n- 边界：如果清理后不是11位数字，返回 None\n```\n\n**AI 生成的代码**：\n\n```{python}\n#| eval: true\ndef format_phone(phone):\n    \"\"\"格式化手机号为 xxx-xxxx-xxxx 格式\"\"\"\n    if not phone:\n        return None\n    \n    # 只保留数字\n    cleaned = ''.join(c for c in phone if c.isdigit())\n    \n    # 检查长度\n    if len(cleaned) != 11:\n        return None\n    \n    return f\"{cleaned[:3]}-{cleaned[3:7]}-{cleaned[7:]}\"\n\n# 测试\nprint(format_phone(\"138 0013 8000\"))     # 138-0013-8000\nprint(format_phone(\"138-0013-8000\"))     # 138-0013-8000\nprint(format_phone(\"12345\"))             # None\n```\n\n---\n\n## 函数设计原则\n\n### 单一职责原则\n\n一个函数只做一件事！\n\n```{mermaid}\nflowchart LR\n    subgraph \"❌ 不好的设计\"\n        A[\"calculate_and_print_and_save()\"]\n    end\n    \n    subgraph \"✅ 好的设计\"\n        B[\"calculate()\"] --> C[\"format()\"]\n        C --> D[\"save()\"]\n    end\n```\n\n**❌ 不好**：\n```python\ndef process_scores(scores):\n    avg = sum(scores) / len(scores)  # 计算\n    print(f\"平均分: {avg}\")           # 打印\n    with open(\"result.txt\", \"w\") as f:  # 保存\n        f.write(str(avg))\n    return avg\n```\n\n**✅ 好**：\n```python\ndef calculate_average(scores):\n    return sum(scores) / len(scores)\n\ndef format_result(avg):\n    return f\"平均分: {avg:.2f}\"\n\ndef save_result(result, filepath):\n    with open(filepath, \"w\") as f:\n        f.write(result)\n```\n\n### 设计原则速查\n\n| 原则 | 说明 | 示例 |\n|-----|------|------|\n| **单一职责** | 一个函数只做一件事 | ✅ `calculate_avg()` ❌ `calculate_avg_and_print()` |\n| **明确命名** | 用动词开头，表达意图 | ✅ `get_user()` ❌ `user()` |\n| **参数有意义** | 参数名要有含义 | ✅ `(name, age)` ❌ `(a, b)` |\n| **返回值明确** | 类型一致，避免意外 | ✅ 总是返回数字 ❌ 有时返回数字有时返回字符串 |\n| **处理边界** | 考虑异常情况 | 空列表、无效输入 |\n\n---\n\n## 实战：设计成绩分析模块\n\n让我们一起设计一个成绩分析模块，包含多个函数。\n\n### 第一步：需求分解\n\n```{mermaid}\nflowchart TD\n    A[\"成绩分析需求\"] --> B[\"加载数据\"]\n    A --> C[\"基础统计\"]\n    A --> D[\"等级分析\"]\n    A --> E[\"生成报告\"]\n    \n    B --> B1[\"load_scores()\"]\n    C --> C1[\"calculate_average()\"]\n    C --> C2[\"get_max_min()\"]\n    D --> D1[\"get_grade_distribution()\"]\n    E --> E1[\"generate_report()\"]\n```\n\n### 第二步：逐个实现\n\n```{python}\n#| eval: true\ndef calculate_average(scores):\n    \"\"\"计算平均分\"\"\"\n    if not scores:\n        return None\n    return sum(scores) / len(scores)\n\ndef get_max_min(scores):\n    \"\"\"获取最高分和最低分\"\"\"\n    if not scores:\n        return None, None\n    return max(scores), min(scores)\n\ndef get_grade_distribution(scores):\n    \"\"\"统计各等级人数\"\"\"\n    distribution = {\"优秀\": 0, \"良好\": 0, \"中等\": 0, \"及格\": 0, \"不及格\": 0}\n    for score in scores:\n        grade = score_to_grade(score)\n        if grade in distribution:\n            distribution[grade] += 1\n    return distribution\n\ndef generate_report(scores):\n    \"\"\"生成分析报告\"\"\"\n    avg = calculate_average(scores)\n    max_score, min_score = get_max_min(scores)\n    distribution = get_grade_distribution(scores)\n    \n    return {\n        \"人数\": len(scores),\n        \"平均分\": round(avg, 2) if avg else None,\n        \"最高分\": max_score,\n        \"最低分\": min_score,\n        \"等级分布\": distribution\n    }\n\n# 测试\nscores = [92, 85, 78, 65, 55, 88, 72, 60, 95, 42]\nreport = generate_report(scores)\nprint(report)\n```\n\n---\n\n## Cursor 实用技巧\n\n### Tab 补全\n\n在 Cursor 中，输入函数签名后，AI 会自动预测函数体：\n\n```python\ndef calculate_average(scores):\n    # 输入到这里，按 Tab 让 AI 补全\n```\n\n### Ctrl+K 生成\n\n1. 把光标放在想要生成代码的位置\n2. 按 `Ctrl+K`（Mac: `Cmd+K`）\n3. 输入描述，如：\"写一个函数计算列表中正数的个数\"\n4. AI 直接在光标位置生成代码\n\n### 选中后让 AI 重构\n\n1. 选中一段代码\n2. 按 `Ctrl+L`（Mac: `Cmd+L`）\n3. 说：\"把这段代码重构成函数\"\n\n---\n\n## 课后作业\n\n### 开始作业 2：成绩统计分析器\n\n**本周任务**：用 AI 生成以下函数：\n\n1. `load_csv(filepath)` - 加载成绩文件\n2. `calculate_average(scores)` - 计算平均分\n3. `get_distribution(scores)` - 生成分数分布\n4. `get_ranking(students)` - 生成排名（处理并列）\n\n**REPORT.md 要求**：\n- 展示至少 2 个函数的 Prompt 设计过程\n- 分析 AI 第一次生成的代码有什么需要修改的\n\n---\n\n## 本章小结\n\n- **函数**是代码复用的基本单元：一次编写，多次调用\n- **函数设计原则**：单一职责、明确命名、处理边界\n- **Prompt 技巧**：描述功能、输入输出、边界情况、示例\n- **Cursor 技巧**：Tab 补全、Ctrl+K 生成、选中重构\n- 先想清楚**函数签名**（名称、参数、返回值），再让 AI 写实现\n\n下一章，我们将学习**数据结构**——如何选择合适的方式组织数据。\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":false,"toc-depth":3,"number-sections":true,"highlight-style":{"light":"github","dark":"dracula"},"output-file":"04-functions.html"},"language":{"toc-title-document":"目录","toc-title-website":"该页面内容","related-formats-title":"其他格式","related-notebooks-title":"笔记本","source-notebooks-prefix":"资源","other-links-title":"其他链接","code-links-title":"代码链接","launch-dev-container-title":"启动 Dev Container","launch-binder-title":"启动 Binder","article-notebook-label":"文章笔记本","notebook-preview-download":"下载笔记本","notebook-preview-download-src":"下载源代码","notebook-preview-back":"返回文章","manuscript-meca-bundle":"MECA 存档","section-title-abstract":"摘要","section-title-appendices":"附录","section-title-footnotes":"脚注","section-title-references":"参考文献","section-title-reuse":"二次使用","section-title-copyright":"版权","section-title-citation":"引用格式","appendix-attribution-cite-as":"请按如下格式引用：","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"查看许可协议","title-block-author-single":"作者","title-block-author-plural":"作者","title-block-affiliation-single":"单位","title-block-affiliation-plural":"单位","title-block-published":"发布于","title-block-modified":"修改于","title-block-keywords":"关键词","callout-tip-title":"提示","callout-note-title":"注记","callout-warning-title":"警告","callout-important-title":"重要","callout-caution-title":"注意","code-summary":"代码","code-tools-menu-caption":"代码","code-tools-show-all-code":"显示所有代码","code-tools-hide-all-code":"隐藏所有代码","code-tools-view-source":"查看源代码","code-tools-source-code":"源代码","tools-share":"Share","tools-download":"Download","code-line":"行","code-lines":"行","copy-button-tooltip":"复制到剪贴板","copy-button-tooltip-success":"已复制","repo-action-links-edit":"编辑该页面","repo-action-links-source":"查看代码","repo-action-links-issue":"反馈问题","back-to-top":"回到顶部","search-no-results-text":"没有结果","search-matching-documents-text":"匹配的文档","search-copy-link-title":"复制搜索链接","search-hide-matches-text":"隐藏其它匹配结果","search-more-match-text":"更多匹配结果","search-more-matches-text":"更多匹配结果","search-clear-button-title":"清除","search-text-placeholder":"","search-detached-cancel-button-title":"取消","search-submit-button-title":"提交","search-label":"搜索","toggle-section":"展开或折叠此栏","toggle-sidebar":"展开或折叠侧边栏导航","toggle-dark-mode":"切换深色模式","toggle-reader-mode":"切换阅读器模式","toggle-navigation":"展开或折叠导航栏","crossref-fig-title":"图","crossref-tbl-title":"表","crossref-lst-title":"列表","crossref-thm-title":"定理","crossref-lem-title":"引理","crossref-cor-title":"推论","crossref-prp-title":"命题","crossref-cnj-title":"猜想","crossref-def-title":"定义","crossref-exm-title":"例","crossref-exr-title":"习题","crossref-ch-prefix":"章节","crossref-apx-prefix":"附录","crossref-sec-prefix":"小节","crossref-eq-prefix":"式","crossref-lof-title":"图索引","crossref-lot-title":"表索引","crossref-lol-title":"列表索引","environment-proof-title":"证","environment-remark-title":"注记","environment-solution-title":"解","listing-page-order-by":"排序方式","listing-page-order-by-default":"默认","listing-page-order-by-date-asc":"日期升序","listing-page-order-by-date-desc":"日期降序","listing-page-order-by-number-desc":"降序","listing-page-order-by-number-asc":"升序","listing-page-field-date":"日期","listing-page-field-title":"标题","listing-page-field-description":"描述","listing-page-field-author":"作者","listing-page-field-filename":"文件名","listing-page-field-filemodified":"修改时间","listing-page-field-subtitle":"副标题","listing-page-field-readingtime":"阅读时间","listing-page-field-wordcount":"字数统计","listing-page-field-categories":"分类","listing-page-minutes-compact":"{0} 分钟","listing-page-category-all":"全部","listing-page-no-matches":"无匹配项","listing-page-words":"{0} 字","listing-page-filter":"筛选","draft":"草稿"},"metadata":{"lang":"zh","fig-responsive":true,"quarto-version":"1.8.14","bibliography":["../references.bib"],"theme":{"light":["cosmo","../theme.scss"],"dark":["darkly","../theme.scss"]},"code-copy":true,"number-depth":2,"smooth-scroll":true,"mermaid":{"theme":"neutral","mermaid-format":"svg"}},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"lualatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","toc":true,"number-sections":true,"output-file":"04-functions.pdf"},"language":{"toc-title-document":"目录","toc-title-website":"该页面内容","related-formats-title":"其他格式","related-notebooks-title":"笔记本","source-notebooks-prefix":"资源","other-links-title":"其他链接","code-links-title":"代码链接","launch-dev-container-title":"启动 Dev Container","launch-binder-title":"启动 Binder","article-notebook-label":"文章笔记本","notebook-preview-download":"下载笔记本","notebook-preview-download-src":"下载源代码","notebook-preview-back":"返回文章","manuscript-meca-bundle":"MECA 存档","section-title-abstract":"摘要","section-title-appendices":"附录","section-title-footnotes":"脚注","section-title-references":"参考文献","section-title-reuse":"二次使用","section-title-copyright":"版权","section-title-citation":"引用格式","appendix-attribution-cite-as":"请按如下格式引用：","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"查看许可协议","title-block-author-single":"作者","title-block-author-plural":"作者","title-block-affiliation-single":"单位","title-block-affiliation-plural":"单位","title-block-published":"发布于","title-block-modified":"修改于","title-block-keywords":"关键词","callout-tip-title":"提示","callout-note-title":"注记","callout-warning-title":"警告","callout-important-title":"重要","callout-caution-title":"注意","code-summary":"代码","code-tools-menu-caption":"代码","code-tools-show-all-code":"显示所有代码","code-tools-hide-all-code":"隐藏所有代码","code-tools-view-source":"查看源代码","code-tools-source-code":"源代码","tools-share":"Share","tools-download":"Download","code-line":"行","code-lines":"行","copy-button-tooltip":"复制到剪贴板","copy-button-tooltip-success":"已复制","repo-action-links-edit":"编辑该页面","repo-action-links-source":"查看代码","repo-action-links-issue":"反馈问题","back-to-top":"回到顶部","search-no-results-text":"没有结果","search-matching-documents-text":"匹配的文档","search-copy-link-title":"复制搜索链接","search-hide-matches-text":"隐藏其它匹配结果","search-more-match-text":"更多匹配结果","search-more-matches-text":"更多匹配结果","search-clear-button-title":"清除","search-text-placeholder":"","search-detached-cancel-button-title":"取消","search-submit-button-title":"提交","search-label":"搜索","toggle-section":"展开或折叠此栏","toggle-sidebar":"展开或折叠侧边栏导航","toggle-dark-mode":"切换深色模式","toggle-reader-mode":"切换阅读器模式","toggle-navigation":"展开或折叠导航栏","crossref-fig-title":"图","crossref-tbl-title":"表","crossref-lst-title":"列表","crossref-thm-title":"定理","crossref-lem-title":"引理","crossref-cor-title":"推论","crossref-prp-title":"命题","crossref-cnj-title":"猜想","crossref-def-title":"定义","crossref-exm-title":"例","crossref-exr-title":"习题","crossref-ch-prefix":"章节","crossref-apx-prefix":"附录","crossref-sec-prefix":"小节","crossref-eq-prefix":"式","crossref-lof-title":"图索引","crossref-lot-title":"表索引","crossref-lol-title":"列表索引","environment-proof-title":"证","environment-remark-title":"注记","environment-solution-title":"解","listing-page-order-by":"排序方式","listing-page-order-by-default":"默认","listing-page-order-by-date-asc":"日期升序","listing-page-order-by-date-desc":"日期降序","listing-page-order-by-number-desc":"降序","listing-page-order-by-number-asc":"升序","listing-page-field-date":"日期","listing-page-field-title":"标题","listing-page-field-description":"描述","listing-page-field-author":"作者","listing-page-field-filename":"文件名","listing-page-field-filemodified":"修改时间","listing-page-field-subtitle":"副标题","listing-page-field-readingtime":"阅读时间","listing-page-field-wordcount":"字数统计","listing-page-field-categories":"分类","listing-page-minutes-compact":"{0} 分钟","listing-page-category-all":"全部","listing-page-no-matches":"无匹配项","listing-page-words":"{0} 字","listing-page-filter":"筛选","draft":"草稿"},"metadata":{"block-headings":true,"lang":"zh","bibliography":["../references.bib"],"documentclass":"scrreprt","papersize":"a4","colorlinks":true},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}