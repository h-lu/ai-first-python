{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "# API åŸºç¡€ä¸ LLM å…¥é—¨ {#sec-api}\n",
        "\n",
        "::: {.callout-note}\n",
        "## æœ¬ç« æ¦‚è¦\n",
        "- **è¯¾æ—¶**ï¼š2è¯¾æ—¶ï¼ˆç¬¬11å‘¨ï¼‰\n",
        "- **ç›®æ ‡**ï¼šæŒæ¡ API è°ƒç”¨åŸºç¡€ï¼Œåˆæ­¥ä½“éªŒ LLM API\n",
        ":::\n",
        "\n",
        "## å­¦ä¹ ç›®æ ‡\n",
        "\n",
        "å®Œæˆæœ¬ç« åï¼Œä½ å°†èƒ½å¤Ÿï¼š\n",
        "\n",
        "1. ç†è§£ API å’Œ HTTP åŸºç¡€\n",
        "2. ä½¿ç”¨ requests åº“è°ƒç”¨å…¬å¼€ API\n",
        "3. åˆæ­¥ä½“éªŒ LLM API è°ƒç”¨\n",
        "\n",
        "---\n",
        "\n",
        "## ç¬¬å››é˜¶æ®µå¯¼å¼•\n",
        "\n",
        "```{mermaid}\n",
        "flowchart LR\n",
        "    subgraph \"ç¬¬ä¸‰é˜¶æ®µï¼ˆå·²å®Œæˆï¼‰\"\n",
        "        A[\"æœ¬åœ°æ•°æ®å¤„ç†\"]\n",
        "    end\n",
        "    \n",
        "    subgraph \"ç¬¬å››é˜¶æ®µï¼ˆå¼€å§‹ï¼‰\"\n",
        "        B[\"API è°ƒç”¨\"] --> C[\"LLM åº”ç”¨\"]\n",
        "        C --> D[\"Web å¼€å‘\"]\n",
        "        D --> E[\"ç»¼åˆé¡¹ç›®\"]\n",
        "    end\n",
        "    \n",
        "    A --> B\n",
        "    \n",
        "    style B fill:#e3f2fd\n",
        "```\n",
        "\n",
        "ä»æœ¬ç« å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥ **AI åº”ç”¨ä¸ç»¼åˆé¡¹ç›®** é˜¶æ®µã€‚é¦–å…ˆéœ€è¦æŒæ¡ **API è°ƒç”¨**â€”â€”è¿™æ˜¯ä¸å¤–éƒ¨æœåŠ¡ï¼ˆåŒ…æ‹¬ AI æœåŠ¡ï¼‰äº¤äº’çš„åŸºç¡€æŠ€èƒ½ã€‚\n",
        "\n",
        "---\n",
        "\n",
        "## ä»€ä¹ˆæ˜¯ APIï¼Ÿ\n",
        "\n",
        "### API åŸºæœ¬æ¦‚å¿µ\n",
        "\n",
        "```{mermaid}\n",
        "flowchart LR\n",
        "    A[\"ä½ çš„ç¨‹åº\"] -->|\"è¯·æ±‚ (Request)\"| B[\"æœåŠ¡å™¨ API\"]\n",
        "    B -->|\"å“åº” (Response)\"| A\n",
        "    \n",
        "    C[\"å¤©æ°”æŸ¥è¯¢\"] --> D[\"å‘é€ï¼šæŸ¥è¯¢åŒ—äº¬å¤©æ°”\"]\n",
        "    D --> E[\"è¿”å›ï¼šæ™´ï¼Œ25Â°C\"]\n",
        "    \n",
        "    F[\"AI å¯¹è¯\"] --> G[\"å‘é€ï¼šå¸®æˆ‘å†™ä»£ç \"]\n",
        "    G --> H[\"è¿”å›ï¼šdef hello()...\"]\n",
        "```\n",
        "\n",
        "**API**ï¼ˆApplication Programming Interfaceï¼‰æ˜¯ç¨‹åºä¹‹é—´é€šä¿¡çš„æ¥å£ï¼š\n",
        "\n",
        "| æ¦‚å¿µ | ç±»æ¯” | è¯´æ˜ |\n",
        "|-----|------|------|\n",
        "| API | é¤å…èœå• | å®šä¹‰äº†å¯ä»¥è¯·æ±‚ä»€ä¹ˆæœåŠ¡ |\n",
        "| è¯·æ±‚ | ç‚¹èœ | å‘Šè¯‰æœåŠ¡å™¨ä½ æƒ³è¦ä»€ä¹ˆ |\n",
        "| å“åº” | ä¸Šèœ | æœåŠ¡å™¨è¿”å›çš„æ•°æ® |\n",
        "| JSON | æ ‡å‡†é¤ç›˜ | æ•°æ®çš„æ ‡å‡†æ ¼å¼ |\n",
        "\n",
        "### HTTP è¯·æ±‚æ–¹æ³•\n",
        "\n",
        "| æ–¹æ³• | ç”¨é€” | ä¾‹å­ |\n",
        "|-----|------|------|\n",
        "| **GET** | è·å–æ•°æ® | æŸ¥è¯¢å¤©æ°”ã€è·å–ç”¨æˆ·ä¿¡æ¯ |\n",
        "| **POST** | æäº¤æ•°æ® | å‘é€èŠå¤©æ¶ˆæ¯ã€åˆ›å»ºç”¨æˆ· |\n",
        "\n",
        "::: {.callout-tip}\n",
        "## åˆå­¦è€…åªéœ€å…³æ³¨ GET å’Œ POST\n",
        "- **GET**ï¼šè·å–æ•°æ®ï¼ˆå¦‚æŸ¥è¯¢å¤©æ°”ï¼‰\n",
        "- **POST**ï¼šå‘é€æ•°æ®ï¼ˆå¦‚è°ƒç”¨ LLMï¼‰\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## requests åº“åŸºç¡€\n",
        "\n",
        "### å®‰è£…\n",
        "\n",
        "```bash\n",
        "pip install requests\n",
        "```\n",
        "\n",
        "### å‘é€ GET è¯·æ±‚"
      ],
      "id": "32ecf543"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: true\n",
        "import requests\n",
        "\n",
        "# è·å–å…¬å¼€ API æ•°æ®\n",
        "response = requests.get(\"https://httpbin.org/get\")\n",
        "\n",
        "# æ£€æŸ¥çŠ¶æ€ç \n",
        "print(f\"çŠ¶æ€ç : {response.status_code}\")\n",
        "\n",
        "# è·å– JSON æ•°æ®\n",
        "if response.status_code == 200:\n",
        "    data = response.json()\n",
        "    print(f\"è¿”å›æ•°æ®ç±»å‹: {type(data)}\")\n",
        "    print(f\"è¯·æ±‚ URL: {data.get('url')}\")"
      ],
      "id": "c9623a25",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### å¸¦å‚æ•°çš„è¯·æ±‚"
      ],
      "id": "6a9b5cab"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: true\n",
        "import requests\n",
        "\n",
        "# ä½¿ç”¨ params å‚æ•°ï¼ˆæ¨èï¼‰\n",
        "params = {\n",
        "    \"name\": \"å¼ ä¸‰\",\n",
        "    \"age\": 20,\n",
        "    \"city\": \"åŒ—äº¬\"\n",
        "}\n",
        "response = requests.get(\"https://httpbin.org/get\", params=params)\n",
        "\n",
        "data = response.json()\n",
        "print(\"å‘é€çš„å‚æ•°:\")\n",
        "print(data.get('args'))"
      ],
      "id": "fff15de9",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### å‘é€ POST è¯·æ±‚"
      ],
      "id": "71eb6bbd"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: true\n",
        "import requests\n",
        "\n",
        "# å‘é€ JSON æ•°æ®\n",
        "payload = {\n",
        "    \"username\": \"zhangsan\",\n",
        "    \"email\": \"zhangsan@example.com\"\n",
        "}\n",
        "\n",
        "response = requests.post(\"https://httpbin.org/post\", json=payload)\n",
        "\n",
        "if response.status_code == 200:\n",
        "    data = response.json()\n",
        "    print(\"æœåŠ¡å™¨æ”¶åˆ°çš„æ•°æ®:\")\n",
        "    print(data.get('json'))"
      ],
      "id": "3cd5feae",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## å¤„ç† API å“åº”\n",
        "\n",
        "### å“åº”çŠ¶æ€ç \n",
        "\n",
        "```{mermaid}\n",
        "flowchart TD\n",
        "    A[\"HTTP çŠ¶æ€ç \"] --> B[\"2xx æˆåŠŸ\"]\n",
        "    A --> C[\"4xx å®¢æˆ·ç«¯é”™è¯¯\"]\n",
        "    A --> D[\"5xx æœåŠ¡å™¨é”™è¯¯\"]\n",
        "    \n",
        "    B --> B1[\"200 OK\"]\n",
        "    C --> C1[\"401 Unauthorized\"]\n",
        "    C --> C2[\"404 Not Found\"]\n",
        "    C --> C3[\"429 Too Many Requests\"]\n",
        "    D --> D1[\"500 Server Error\"]\n",
        "```\n",
        "\n",
        "| çŠ¶æ€ç  | å«ä¹‰ | å¤„ç†æ–¹å¼ |\n",
        "|-------|------|---------|\n",
        "| 200 | æˆåŠŸ | æ­£å¸¸å¤„ç†å“åº” |\n",
        "| 401 | æœªæˆæƒ | æ£€æŸ¥ API Key |\n",
        "| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥ URL |\n",
        "| 429 | è¯·æ±‚è¿‡å¤š | ç­‰å¾…åé‡è¯• |\n",
        "| 500 | æœåŠ¡å™¨é”™è¯¯ | ç¨åé‡è¯• |\n",
        "\n",
        "### å®‰å…¨çš„ API è°ƒç”¨å‡½æ•°"
      ],
      "id": "9a564dd7"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: true\n",
        "import requests\n",
        "\n",
        "def safe_api_call(url, params=None):\n",
        "    \"\"\"å®‰å…¨çš„ API è°ƒç”¨å‡½æ•°\"\"\"\n",
        "    try:\n",
        "        response = requests.get(url, params=params, timeout=10)\n",
        "        \n",
        "        if response.status_code == 200:\n",
        "            return {\"success\": True, \"data\": response.json()}\n",
        "        elif response.status_code == 404:\n",
        "            return {\"success\": False, \"error\": \"èµ„æºä¸å­˜åœ¨\"}\n",
        "        elif response.status_code == 401:\n",
        "            return {\"success\": False, \"error\": \"æœªæˆæƒï¼Œè¯·æ£€æŸ¥ API Key\"}\n",
        "        else:\n",
        "            return {\"success\": False, \"error\": f\"HTTP {response.status_code}\"}\n",
        "            \n",
        "    except requests.exceptions.Timeout:\n",
        "        return {\"success\": False, \"error\": \"è¯·æ±‚è¶…æ—¶\"}\n",
        "    except requests.exceptions.ConnectionError:\n",
        "        return {\"success\": False, \"error\": \"ç½‘ç»œè¿æ¥å¤±è´¥\"}\n",
        "    except Exception as e:\n",
        "        return {\"success\": False, \"error\": str(e)}\n",
        "\n",
        "# æµ‹è¯•\n",
        "result = safe_api_call(\"https://httpbin.org/get\", {\"test\": \"hello\"})\n",
        "print(result)"
      ],
      "id": "6dc46292",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## å®æˆ˜ï¼šè°ƒç”¨å…¬å¼€ API\n",
        "\n",
        "### GitHub API ç¤ºä¾‹"
      ],
      "id": "a3a516ee"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: true\n",
        "import requests\n",
        "\n",
        "def get_github_repo_info(owner, repo):\n",
        "    \"\"\"è·å– GitHub ä»“åº“ä¿¡æ¯\"\"\"\n",
        "    url = f\"https://api.github.com/repos/{owner}/{repo}\"\n",
        "    \n",
        "    try:\n",
        "        response = requests.get(url, timeout=10)\n",
        "        \n",
        "        if response.status_code == 200:\n",
        "            data = response.json()\n",
        "            return {\n",
        "                \"åç§°\": data['full_name'],\n",
        "                \"æè¿°\": data['description'][:50] + \"...\" if data['description'] else \"æ— \",\n",
        "                \"Stars\": data['stargazers_count'],\n",
        "                \"è¯­è¨€\": data['language']\n",
        "            }\n",
        "        else:\n",
        "            return {\"error\": f\"HTTP {response.status_code}\"}\n",
        "            \n",
        "    except Exception as e:\n",
        "        return {\"error\": str(e)}\n",
        "\n",
        "# è·å– Python ä»“åº“ä¿¡æ¯\n",
        "info = get_github_repo_info(\"python\", \"cpython\")\n",
        "for key, value in info.items():\n",
        "    print(f\"{key}: {value}\")"
      ],
      "id": "45160ef5",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## LLM API å…¥é—¨\n",
        "\n",
        "### ä¸ºä»€ä¹ˆéœ€è¦ LLM APIï¼Ÿ\n",
        "\n",
        "```{mermaid}\n",
        "flowchart LR\n",
        "    A[\"ä½ çš„åº”ç”¨\"] -->|\"å‘é€ Prompt\"| B[\"LLM API\"]\n",
        "    B -->|\"è¿”å›ç”Ÿæˆæ–‡æœ¬\"| A\n",
        "    \n",
        "    C[\"èŠå¤©æœºå™¨äºº\"] --> D[\"å‘é€ç”¨æˆ·é—®é¢˜\"]\n",
        "    D --> E[\"è¿”å› AI å›ç­”\"]\n",
        "```\n",
        "\n",
        "**åº”ç”¨åœºæ™¯**ï¼š\n",
        "- æ™ºèƒ½å®¢æœ\n",
        "- ä»£ç åŠ©æ‰‹\n",
        "- å†…å®¹ç”Ÿæˆ\n",
        "- æ•°æ®åˆ†æ\n",
        "\n",
        "### API Key å®‰å…¨ç®¡ç†\n",
        "\n",
        "::: {.callout-warning}\n",
        "## æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Keyï¼\n",
        "- âŒ ä¸è¦å†™ `api_key = \"sk-xxxx\"`\n",
        "- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ– .env æ–‡ä»¶\n",
        "- âœ… ä¸è¦å°† Key æäº¤åˆ° Git\n",
        ":::\n",
        "\n",
        "**ä½¿ç”¨ .env æ–‡ä»¶**ï¼š"
      ],
      "id": "ebe84897"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: false\n",
        "# 1. åˆ›å»º .env æ–‡ä»¶\n",
        "# DEEPSEEK_API_KEY=your-api-key-here\n",
        "\n",
        "# 2. å®‰è£…ä¾èµ–\n",
        "# pip install python-dotenv openai\n",
        "\n",
        "# 3. åœ¨ä»£ç ä¸­åŠ è½½\n",
        "from dotenv import load_dotenv\n",
        "import os\n",
        "\n",
        "load_dotenv()\n",
        "API_KEY = os.getenv(\"DEEPSEEK_API_KEY\")"
      ],
      "id": "ea473210",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ requests åº“\n",
        "\n",
        "### ç›´æ¥è°ƒç”¨ API"
      ],
      "id": "d5bbc166"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: false\n",
        "import requests\n",
        "import os\n",
        "from dotenv import load_dotenv\n",
        "\n",
        "load_dotenv()\n",
        "\n",
        "def chat_with_requests(message):\n",
        "    \"\"\"ä½¿ç”¨ requests è°ƒç”¨ DeepSeek API\"\"\"\n",
        "    url = \"https://api.deepseek.com/chat/completions\"\n",
        "    \n",
        "    headers = {\n",
        "        \"Authorization\": f\"Bearer {os.getenv('DEEPSEEK_API_KEY')}\",\n",
        "        \"Content-Type\": \"application/json\"\n",
        "    }\n",
        "    \n",
        "    payload = {\n",
        "        \"model\": \"deepseek-chat\",\n",
        "        \"messages\": [\n",
        "            {\"role\": \"user\", \"content\": message}\n",
        "        ]\n",
        "    }\n",
        "    \n",
        "    try:\n",
        "        response = requests.post(url, headers=headers, json=payload, timeout=30)\n",
        "        \n",
        "        if response.status_code == 200:\n",
        "            data = response.json()\n",
        "            return data['choices'][0]['message']['content']\n",
        "        else:\n",
        "            return f\"é”™è¯¯: HTTP {response.status_code}\"\n",
        "            \n",
        "    except Exception as e:\n",
        "        return f\"é”™è¯¯: {e}\"\n",
        "\n",
        "# ä½¿ç”¨ç¤ºä¾‹\n",
        "# reply = chat_with_requests(\"ç”¨ä¸€å¥è¯è§£é‡Šä»€ä¹ˆæ˜¯API\")\n",
        "# print(reply)"
      ],
      "id": "3435e82d",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## æ–¹æ³•äºŒï¼šä½¿ç”¨ OpenAI åº“ï¼ˆæ¨èï¼‰\n",
        "\n",
        "### å®‰è£… OpenAI åº“\n",
        "\n",
        "```bash\n",
        "pip install openai\n",
        "```\n",
        "\n",
        "### è°ƒç”¨ DeepSeekï¼ˆOpenAI å…¼å®¹ï¼‰\n",
        "\n",
        "DeepSeek API ä¸ OpenAI API å®Œå…¨å…¼å®¹ï¼Œåªéœ€ä¿®æ”¹ `base_url`ï¼š"
      ],
      "id": "4ea7498f"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: false\n",
        "from openai import OpenAI\n",
        "import os\n",
        "from dotenv import load_dotenv\n",
        "\n",
        "load_dotenv()\n",
        "\n",
        "# åˆ›å»ºå®¢æˆ·ç«¯ï¼ŒæŒ‡å‘ DeepSeek\n",
        "client = OpenAI(\n",
        "    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n",
        "    base_url=\"https://api.deepseek.com\"\n",
        ")\n",
        "\n",
        "def chat_with_openai(message):\n",
        "    \"\"\"ä½¿ç”¨ OpenAI åº“è°ƒç”¨ DeepSeek API\"\"\"\n",
        "    try:\n",
        "        response = client.chat.completions.create(\n",
        "            model=\"deepseek-chat\",\n",
        "            messages=[\n",
        "                {\"role\": \"user\", \"content\": message}\n",
        "            ]\n",
        "        )\n",
        "        return response.choices[0].message.content\n",
        "    except Exception as e:\n",
        "        return f\"é”™è¯¯: {e}\"\n",
        "\n",
        "# ä½¿ç”¨ç¤ºä¾‹\n",
        "# reply = chat_with_openai(\"ç”¨ä¸€å¥è¯è§£é‡Šä»€ä¹ˆæ˜¯API\")\n",
        "# print(reply)"
      ],
      "id": "dae29d7c",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### å¸¦ System Prompt çš„è°ƒç”¨"
      ],
      "id": "211deb8f"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: false\n",
        "from openai import OpenAI\n",
        "import os\n",
        "from dotenv import load_dotenv\n",
        "\n",
        "load_dotenv()\n",
        "\n",
        "client = OpenAI(\n",
        "    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n",
        "    base_url=\"https://api.deepseek.com\"\n",
        ")\n",
        "\n",
        "def chat_with_system_prompt(message, system_prompt=\"ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„åŠ©æ‰‹\"):\n",
        "    \"\"\"å¸¦ç³»ç»Ÿæç¤ºçš„å¯¹è¯\"\"\"\n",
        "    response = client.chat.completions.create(\n",
        "        model=\"deepseek-chat\",\n",
        "        messages=[\n",
        "            {\"role\": \"system\", \"content\": system_prompt},\n",
        "            {\"role\": \"user\", \"content\": message}\n",
        "        ],\n",
        "        temperature=0.7  # æ§åˆ¶åˆ›é€ æ€§ï¼Œ0-2\n",
        "    )\n",
        "    return response.choices[0].message.content\n",
        "\n",
        "# ä½¿ç”¨ç¤ºä¾‹\n",
        "# reply = chat_with_system_prompt(\n",
        "#     \"å†™ä¸€å¥åŠ±å¿—çš„è¯\",\n",
        "#     system_prompt=\"ä½ æ˜¯ä¸€ä¸ªå……æ»¡æ­£èƒ½é‡çš„å¿ƒç†å’¨è¯¢å¸ˆ\"\n",
        "# )\n",
        "# print(reply)"
      ],
      "id": "0efc4fe9",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## requests vs OpenAI åº“å¯¹æ¯”\n",
        "\n",
        "```{mermaid}\n",
        "flowchart TD\n",
        "    subgraph \"requests æ–¹å¼\"\n",
        "        R1[\"æ‰‹åŠ¨æ„å»º headers\"]\n",
        "        R2[\"æ‰‹åŠ¨æ„å»º payload\"]\n",
        "        R3[\"æ‰‹åŠ¨è§£æ JSON\"]\n",
        "    end\n",
        "    \n",
        "    subgraph \"OpenAI åº“\"\n",
        "        O1[\"è‡ªåŠ¨å¤„ç†è®¤è¯\"]\n",
        "        O2[\"ç±»å‹æç¤ºæ”¯æŒ\"]\n",
        "        O3[\"å†…ç½®é‡è¯•æœºåˆ¶\"]\n",
        "    end\n",
        "```\n",
        "\n",
        "| ç‰¹æ€§ | requests | OpenAI åº“ |\n",
        "|-----|----------|----------|\n",
        "| **å®‰è£…ä¾èµ–** | å·²å†…ç½® | éœ€å®‰è£… `openai` |\n",
        "| **ä»£ç é‡** | è¾ƒå¤š | ç®€æ´ |\n",
        "| **ç±»å‹æç¤º** | æ—  | âœ… å®Œå–„ |\n",
        "| **è‡ªåŠ¨é‡è¯•** | éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½® |\n",
        "| **æµå¼è¾“å‡º** | è¾ƒå¤æ‚ | âœ… ç®€å• |\n",
        "| **é”™è¯¯å¤„ç†** | éœ€æ‰‹åŠ¨ | âœ… å¼‚å¸¸ç±»å‹æ¸…æ™° |\n",
        "| **åˆ‡æ¢æ¨¡å‹** | æ”¹ URL | æ”¹ `base_url` |\n",
        "| **å­¦ä¹ ä»·å€¼** | ç†è§£ HTTP åŸç† | æ›´æ¥è¿‘ç”Ÿäº§ä»£ç  |\n",
        "\n",
        "::: {.callout-tip}\n",
        "## æ¨èä½¿ç”¨ OpenAI åº“\n",
        "OpenAI åº“æ˜¯ä¸šç•Œæ ‡å‡†ï¼ŒDeepSeekã€é€šä¹‰åƒé—®ç­‰å›½äº§æ¨¡å‹éƒ½å…¼å®¹ OpenAI æ ¼å¼ã€‚\n",
        "æŒæ¡ OpenAI åº“ = æŒæ¡äº†è°ƒç”¨å¤§å¤šæ•° LLM çš„æ–¹æ³•ã€‚\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## åˆ‡æ¢ä¸åŒçš„ LLM æœåŠ¡\n",
        "\n",
        "OpenAI åº“çš„ä¼˜åŠ¿ï¼šåªéœ€ä¿®æ”¹ `base_url` å’Œ `api_key`ï¼Œä»£ç é€»è¾‘å®Œå…¨ä¸å˜ï¼š"
      ],
      "id": "1051dfa7"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| eval: false\n",
        "from openai import OpenAI\n",
        "import os\n",
        "\n",
        "# DeepSeek\n",
        "deepseek_client = OpenAI(\n",
        "    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n",
        "    base_url=\"https://api.deepseek.com\"\n",
        ")\n",
        "\n",
        "# é€šä¹‰åƒé—® (Qwen)\n",
        "qwen_client = OpenAI(\n",
        "    api_key=os.getenv(\"DASHSCOPE_API_KEY\"),\n",
        "    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\"\n",
        ")\n",
        "\n",
        "# OpenAI (å®˜æ–¹)\n",
        "openai_client = OpenAI(\n",
        "    api_key=os.getenv(\"OPENAI_API_KEY\")\n",
        "    # ä¸éœ€è¦ base_urlï¼Œé»˜è®¤å°±æ˜¯ OpenAI\n",
        ")\n",
        "\n",
        "# è°ƒç”¨æ–¹å¼å®Œå…¨ç›¸åŒï¼\n",
        "def chat(client, model, message):\n",
        "    response = client.chat.completions.create(\n",
        "        model=model,\n",
        "        messages=[{\"role\": \"user\", \"content\": message}]\n",
        "    )\n",
        "    return response.choices[0].message.content"
      ],
      "id": "b6e450a8",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## è¯¾åä½œä¸š\n",
        "\n",
        "### æœŸæœ«é¡¹ç›®å‡†å¤‡\n",
        "\n",
        "**æœ¬å‘¨ä»»åŠ¡**ï¼šé€‰é¢˜ä¸ API è°ƒç ”\n",
        "\n",
        "1. ç¡®å®šæœŸæœ«é¡¹ç›®ä¸»é¢˜\n",
        "2. æ³¨å†Œ DeepSeek API è´¦å·\n",
        "3. ä½¿ç”¨ OpenAI åº“å®Œæˆä¸€æ¬¡ API è°ƒç”¨\n",
        "4. æµ‹è¯• System Prompt æ•ˆæœ\n",
        "\n",
        "**é€‰é¢˜å»ºè®®**ï¼š\n",
        "- ğŸ’¬ æ™ºèƒ½é—®ç­”åŠ©æ‰‹\n",
        "- ğŸ“Š æ•°æ®åˆ†ææŠ¥å‘Šç”Ÿæˆå™¨\n",
        "- ğŸŒ¤ï¸ å¤©æ°”æ’­æŠ¥æœºå™¨äºº\n",
        "- ğŸ“ æ–‡ç« æ‘˜è¦å·¥å…·\n",
        "\n",
        "---\n",
        "\n",
        "## æœ¬ç« å°ç»“\n",
        "\n",
        "- **API** æ˜¯ç¨‹åºé—´é€šä¿¡çš„æ¥å£ï¼Œé€šè¿‡ HTTP è¯·æ±‚äº¤äº’\n",
        "- **requests** åº“é€‚åˆç†è§£åŸç†ï¼Œ**OpenAI** åº“æ›´é€‚åˆç”Ÿäº§ä½¿ç”¨\n",
        "- **OpenAI åº“ä¼˜åŠ¿**ï¼šç®€æ´ã€ç±»å‹å®‰å…¨ã€å†…ç½®é‡è¯•ã€æ˜“åˆ‡æ¢æ¨¡å‹\n",
        "- **API Key** è¦å®‰å…¨å­˜å‚¨ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡\n",
        "- **DeepSeek/é€šä¹‰åƒé—®** éƒ½å…¼å®¹ OpenAI æ ¼å¼\n",
        "\n",
        "```{mermaid}\n",
        "flowchart LR\n",
        "    A[\"æœ¬ç« ï¼šAPI åŸºç¡€\"] --> B[\"ä¸‹ç« ï¼šLLM é«˜çº§åº”ç”¨\"]\n",
        "    B --> C[\"å¤šè½®å¯¹è¯\"]\n",
        "    B --> D[\"Prompt å·¥ç¨‹\"]\n",
        "    B --> E[\"æµå¼è¾“å‡º\"]\n",
        "```\n",
        "\n",
        "ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ·±å…¥å­¦ä¹  **LLM é«˜çº§åº”ç”¨**â€”â€”å¤šè½®å¯¹è¯ä¸ Prompt å·¥ç¨‹ã€‚\n"
      ],
      "id": "828b615a"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/Users/wangxq/.pyenv/versions/3.9.13/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}